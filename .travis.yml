language: python
python:
- 3.6
sudo: required
env:
  global:
  - DJANGO_DEBUG=1
  - UPLOADCARE_DISABLED=1
  - ROLLBAR_DISABLED=1
  - DJANGO_SECRET_KEY=foo
  - DATABASE_URL=postgres://travis@127.0.0.1/travis_ci_test
  - HOSTNAMES=localhost
addons:
  postgresql: 9.6
services:
- elasticsearch
- postgresql
before_install:
- curl -O https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/deb/elasticsearch/2.4.0/elasticsearch-2.4.0.deb
  && sudo dpkg -i --force-confnew elasticsearch-2.4.0.deb && sudo service elasticsearch
  restart
install:
- pip install pipenv
- pipenv install
before_script:
- psql -c 'CREATE DATABASE travis_ci_test;' -U postgres
script:
- python manage.py collectstatic
- python manage.py test pylinks
deploy:
  provider: heroku
  api_key:
    secure: Y2B6rU+c8aBb7LcW2aU2v+9twK6EPlpY7apFNVKGFCB/seZ5Ooc2vOtuIRYQs+FftgLR5Cs4nU8ceYJZJA8qIN2qiVq5CeL4qbOfZ5lK2ijsp2M58HYqU5s45Gv9NSIvMg4PKjkRJojy+sodEL/f9SI+Ktx+Dr8OlbGcoiw8aTM=
  app: pseupdate
  on: main
